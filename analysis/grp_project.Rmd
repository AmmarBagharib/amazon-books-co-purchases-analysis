---
title: "Group Project (exploration)"
author: "group"
date: "2023-09-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(dplyr)
library(tidyr)
library(igraph)
library(data.table)
library(glue)
library(gridExtra)
library(ggplot2)
library(stringr)
library(here)
```

```{r , setup, include=FALSE}
#set working directory to project root folder
knitr::opts_knit$set(root.dir = here())
```

**Project Background**

Established in 1995 as a pioneering online bookstore, Amazon has been a cherished destination for book enthusiasts for several decades. While the company has evolved and expanded into a diverse range of industries, it has consistently maintained its status as a go-to hub for book shoppers.

In the scope of this project, our objective is to delve into the evolving co-purchase patterns of books over time, understand it's characteristics and underlying patterns. With these information, we'll then develop a model that can provide personalized book recommendations based on books which the customer has added to his/her basket.

In doing so, we anticipate that our efforts will yield a mutually beneficial outcome. By facilitating book discoveries and guiding readers to titles they might not have encountered otherwise, we aim to stimulate sales on the platform, benefiting both Amazon and its thriving community of book lovers.

**1. Network Characteristics**

```{r read_data}
set.seed(123)

# Read the graph from the GraphML file
g <- read_graph(here("outputs/filtered_graph.graphml"), format = "graphml")
# read filtered book data
books_df <- read.csv(here("outputs/book_filtered.csv"))

g

head(books_df)

```



```{r node_attributes}

# store attributes into a data.frame
node_attributes_df=data.frame(vertex_id=V(g)$name, 
                              degree=degree(g), # adding the vertex level attributes
                              closeness=closeness(g, mode='all'),
                              betweenness=betweenness(g, directed=FALSE),
                              transitivity=transitivity(g,type="localundirected"), # There are many NaN transitivity values; it means these nodes are isolated?
                              eigen_centrality = eigen_centrality(g)$vector,
                              page_rank = page_rank(g)$vector,
                              component_membership = components(g)$membership) #should we specify weakly or strongly connected component?


head(node_attributes_df)
```

```{r graph-attributes}
global_transitivity = transitivity(g, type="global")
density = graph.density(g)
message(paste("Global transitivity is", global_transitivity, "and density is", density))
```

**2.1. Degree Centrality**

In the context of our project, degree represents the number of other books which a given book is co-purchased with - books with high degree centrality are frequently purchased together with other books. From the graphs, we can see that the network's degree distribution follows the power-law, which is a characteristic of a naturally-occurring graph; most books have low in-degree and only a small number of them have high in-degree. the distribution is extremely left-skewed and we have to use a log scale to properly visualize them. To the extreme right, we can see that a small number of books are extremely popular and are co-purchased with more than 1500 other books. 

```{r deg_visualization, fig.width=15, fig.height=5}
#function to plot histogram
plot_hist <- function(g, title, x_label, y_label, log_scale = TRUE) {
  ls <- scale_y_continuous(trans = "log10")
  labels <- labs(y = y_label, x = x_label, title = title)  # Added title parameter
  graph <- ggplot() + geom_histogram(aes(x = g), bins = 100) + labels
  
  if (log_scale == TRUE) {
    return(graph + ls)
  } else {
    return(graph)
  }
}

#calculate degree centrality for each graph
deg <- degree(g, mode = "in")

plot_hist(deg, "in-degree distribution for 0302", "in-degree", "frequency (log scale)")

```

# Clusters

```{r component, fig.width = 15, fig.height = 10}

#get largest component
comps <- clusters(g)
largest_comp_ind <- which.max(comps$csize)
largest_comp_vert <- which(comps$membership == largest_comp_ind)
largest_comp_subg <- induced_subgraph(g, largest_comp_vert)

#visualize largest component
plot(largest_comp_subg, layout = layout.fruchterman.reingold(g), vertex.size = degree(largest_comp_subg))
#degree distribution for sampled graph
plot_hist(degree(g), "Degree Centrality distribution for sampled graph", "degree centrality", "frequency", log_scale = FALSE)
#degree distribution for largest component
plot_hist(degree(largest_comp_subg), "Degree Centrality distribution for largest component", "degree centrality", "frequency", log_scale = FALSE)
```


# Clustering

Source Codes

https://cran.r-project.org/web/packages/linkprediction/linkprediction.pdf

https://rpubs.com/writetosamadalvi/CommunityDetection

https://users.dimi.uniud.it/~massimo.franceschet/R/communities.html

https://rstudio-pubs-static.s3.amazonaws.com/734940_93adb495f0e34ca291fcda1d214129d1.html#Service_as_a_Freelancer









